#!/usr/bin/python2

import subprocess
import sys

killExtra = '';
if '-9' in sys.argv:
	killExtra = ' -9 '
	sys.argv.remove('-9')


if len(sys.argv) < 2:
	sys.stderr.write("Usage: killall ([optional signal]) [prog1] ([prog2], [prog3]...)\n")
	sys.exit(1)
	

pids = []
retCode = 0
for procName in sys.argv[1:]:
	pipe = subprocess.Popen("pidof " + procName, shell=True, stdout=subprocess.PIPE)
	thesePids = pipe.stdout.read().replace("\n", "").replace("\r", "").split(' ')
        thesePids = [pid for pid in thesePids if pid]
	ret = pipe.wait()
        if ret == 1 or len(thesePids) == 0:
            sys.stderr.write(procName + ": no process found\n")
            retCode = 1
        else:
            pids += thesePids
        
if len(pids) > 0:
    pids = list(set(pids))
    pidsStr = ' '.join(pids)
    print "Killing: " + pidsStr

    subprocess.Popen('kill %s %s' %(killExtra, pidsStr), shell=True).wait()

sys.exit(retCode)
